<!DOCTYPE html>
<html lang="en">
<head>
  <title>Patient List</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
  <script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBHkznc6I46EAtk3L8bKm3h3t2Yx9NUyZI",
    authDomain: "phys-it.firebaseapp.com",
    databaseURL: "https://phys-it.firebaseio.com",
    projectId: "phys-it",
    storageBucket: "phys-it.appspot.com",
    messagingSenderId: "960737516865"
  };
  firebase.initializeApp(config);
</script>
<style>
#patients {
  width: 100%;
}

</style>
</head>
<body>
  <div id = "wrapper">
    <div id = "title">
      <h1>Patient List</h1>
    </div>
    <div id = "listcontainer">
      <table id="patients">
        <thead>
          <tr>
            <td>First Name</td>
            <td>Last Name</td>
            <td>Phone Number</td>
            <td>Appointment Time</td>
            <td>Action</td>
          </tr>
        </thead>
      </table>
    </div>
  </div>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script>
  var physioUID;

  firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
      // User is signed in.
      physioUID = user.uid;
      var id = physioUID
    } else {
      // No user is signed in.
      alert("nope");
    }

    //var name, email;
    if (user != null) {
      name = user.displayName;
      email = user.email;
      photoUrl = user.photoURL;
      emailVerified = user.emailVerified;
      uid = user.uid;
    }

    var ref = firebase.database().ref("Users/" + physioUID);
    ref.on(
      "value",
      function(snap) {

        snap.forEach(function(snapshot){
          var patientid = snapshot.key;
          console.log(patientid)
          var patientref = firebase.database().ref("Patients/" + patientid);
          patientref.on(
            "value",
            function(snap) {
              function setPatientId(obj){
                localStorage.setItem('patientid', obj.value);
                console.log(obj.value);
              }
              console.log(JSON.stringify(snap.val().FirstName));
              var content = '';
              content +='<tr>';
              content += '<td>' + snap.val().FirstName +'</td>';
              content += '<td>' + snap.val().LastName + '</td>';
              content += '<td>' + snap.val().PhoneNumber + '</td>';
              content += '<td>' + snap.val().AppointmentTime + '</td>';
              content += '<td><button><a href="patientprofile.html"'
              + 'onclick="sessionStorage.setItem(\'patientid\', \'' + patientid + '\');">'
              + 'View</a></button></td>';
              content += '</tr>';
              $('#patients').append(content);
            });

          });
        });
      });
      </script>
    </body>
    </html>
